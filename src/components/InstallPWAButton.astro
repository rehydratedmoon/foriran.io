---
// const {supportsPWA, promptEvent, setPromptEvent} = usePWA();
// const [isTooEarly, setIsTooEarly] = useState(true);
// useEffect(() => {
//   setTimeout(() => {
//     setIsTooEarly(false);
//   }, 2000);
// }, []);
---

<pwa-button>
  <div class='space-y-6'>
    <button
      aria-label='Heart'
      class='btn-prm fw-500 bf-i-ph-download-simple'
      id='setup_button'
      aria-label='Install app'
      title='Install app'
      disabled
    >
      Ù†ØµØ¨ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
    </button>

    <div id='unsupported-warning' class='snack-warning'>
      <p>Ù…Ø±ÙˆØ±Ú¯Ø±â€Œ Ø´Ù…Ø§ Ø§Ø² Ù†ØµØ¨ PWA Ù¾ÛŒØ´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.</p>
      <p>Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø± Ú©Ø±ÙˆÙ… Ø¨Ø±Ø§ÛŒ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯ Ùˆ ÙˆÛŒÙ†Ø¯ÙˆØ²ØŒ Ùˆ Ù…Ø±ÙˆØ±Ú¯Ø± Ø³Ø§ÙØ§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ iOS Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
      <p>
        ÙÙ‡Ø±Ø³Øª Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ÛŒ Ø¯Ø§Ø±Ø§ÛŒ Ø§Ù…Ú©Ø§Ù†Ø§Øª PWA Ø±Ø§
        {` `}
        <a href='https://caniuse.com/web-app-manifest'> Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§</a>
        {` `}
        Ø¨Ø¨ÛŒÙ†ÛŒØ¯.
      </p>
    </div>
  </div>
</pwa-button>

<script>
  class PwaButton extends HTMLElement {
    constructor() {
      super();

      let promptEvent: any;
      let supportsPWA: boolean | null = null;

      const pwaButton = this.querySelector('button');
      const warningMessage = this.querySelector('#unsupported-warning');

      const handler: EventListenerOrEventListenerObject = (e) => {
        e.preventDefault();
        promptEvent = e;
        supportsPWA = true;
        pwaButton.disabled = false;

        pwaButton?.addEventListener('click', async (e) => {
          e.preventDefault();
          if (!promptEvent) return;
          const result = await promptEvent.userChoice;
          console.log('ğŸš€ ~ result:', result);
          promptEvent = null;
        });
          console.log("ğŸš€ ~ promptEvent:", promptEvent)
        warningMessage.style.display = 'none';
      };

      window.addEventListener('beforeinstallprompt', handler);

      window.removeEventListener('transitionend', handler);
      console.log('ğŸš€ ~ hii');
      console.log('ğŸš€ ~ promptEvent:', promptEvent);

      // const installButton = document.querySelector('#setup_button');

      // Define the behaviour for our new type of HTML element.
      if (supportsPWA !== true) supportsPWA = false;
      console.log('ğŸš€ ~ promptEvent:', promptEvent);
      console.log('ğŸš€ ~ supportsPWA:', supportsPWA);

      // Each time the button is clicked, update the count.
      if (supportsPWA) {
      } else {
      }
    }
  }

  // Tell the browser to use our AstroHeart class for <astro-heart> elements.
  customElements.define('pwa-button', PwaButton);
</script>
