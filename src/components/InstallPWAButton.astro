---
// <!-- import React, {useEffect, useState} from "react"; -->
// <!-- import {usePWA} from "./PWAProvider"; -->

// const InstallPWAButton = () => {
//  const [supportsPWA, setSupportsPWA] = useState(false);
//  const [promptEvent, setPromptEvent] = useState<any>(null);
---

<div class='space-y-6'>
  <button class='btn-prm fw-500 bf-i-ph-download-simple' id='pwa-install-button'> نصب اپلیکیشن</button>
  <!-- {

      <div class='snack-warning'>
        <p>مرورگر‌ شما از نصب PWA پیشتیبانی نمی‌کند.</p>
        <p>می‌توانید از مرورگر کروم برای اندروید و ویندوز، و مرورگر سافاری برای iOS استفاده کنید.</p>
        <p>
          فهرست مرورگرهای دارای امکانات PWA را
          {` `}
          <a href='https://caniuse.com/web-app-manifest'> از اینجا</a>
          {` `}
          ببینید.
        </p>
      </div>
  } -->
</div>

<script>
  let promptEvent: Event | null = null;
  let installed = false;
  // const handler: EventListenerOrEventListenerObject =
  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    console.log('before install...');
    promptEvent = e;
    console.log('🚀 ~ promptEvent:', promptEvent);
  });

  const pwaInstallButton = document.querySelector('#pwa-install-button');

  // pwaInstallButton?.addEventListener('click', async (e) => {
  //   e.preventDefault();
  //   console.log('🚀 ~ promptEvent:', promptEvent);

  //   if (promptEvent === null) return;
  //   const result = await promptEvent.userChoice;
  //   promptEvent = null;
  //   console.log('🚀 ~ result:', result);
  // });

  // let installed = false;
  pwaInstallButton?.addEventListener('click', async function (e) {
    e.preventDefault();
    console.log('🚀 ~ promptEvent:', promptEvent);
    // if (promptEvent === null) return;
    promptEvent?.prompt();
    let result = await promptEvent.userChoice;
    if (result && result.outcome === 'accepted') {
      installed = true;
    }
    promptEvent = null;
  });
</script>
